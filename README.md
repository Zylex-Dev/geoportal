# Геопортал объектов черной металлургии Челябинской области

Интерактивный геопортал для визуализации и работы с пространственными данными объектов черной металлургии Челябинской области.

## Технологии

- Frontend: HTML, CSS, JavaScript, OpenLayers
- Backend: GeoServer
- Инфраструктура: Docker, Nginx

## Особенности

- Интерактивная карта с различными базовыми подложками
- Отображение промышленных объектов черной металлургии
- Инструменты для измерения и идентификации объектов
- Полностью контейнеризированное решение
- Локальные библиотеки для автономной работы
- Преднастроенный GeoServer с готовыми слоями и стилями

## Запуск проекта

### Предварительные требования

- Docker и Docker Compose
- Git для клонирования репозитория

### Инструкции по запуску

1. Клонируйте репозиторий:
   ```bash
   git clone [URL репозитория]
   cd geoportal
   ```

2. Запустите проект с помощью Docker Compose:
   ```bash
   docker-compose up -d
   ```

3. Откройте геопортал в браузере:
   ```
   http://localhost
   ```

4. GeoServer будет доступен по адресу:
   ```
   http://localhost:8080/geoserver
   ```
   - Логин: admin
   - Пароль: geoserver

### Остановка проекта

```bash
docker-compose down
```

## Структура проекта

- `/css` - стили
- `/js` - JavaScript модули
- `/lib` - локальные библиотеки (создаются при сборке Docker)
- `/geoserver_data` - предварительно настроенные данные GeoServer (слои, стили, настройки)
- `/database` - данные и скрипты для PostgreSQL
  - `/database/init` - скрипты инициализации базы данных
  - `/database/data` - данные PostgreSQL
- `Dockerfile` - конфигурация сборки контейнера фронтенда
- `nginx.conf` - конфигурация веб-сервера Nginx
- `docker-compose.yml` - конфигурация для запуска всех контейнеров

## Примечания по разработке

При необходимости изменения конфигурации GeoServer, файлы данных сохраняются в volume `geoserver_data` и сохраняются между перезапусками.

## Модули JavaScript

- **config.js** - Содержит основные настройки и конфигурацию геопортала, а также утилиту логирования
- **server.js** - Функционал для проверки подключения к GeoServer 
- **layers.js** - Создание и управление слоями карты (базовые слои, промышленные, природные и др.)
- **controls.js** - Создание и настройка элементов управления картой (зум, панель слоев и т.д.)
- **tools.js** - Инструменты для работы с картой (измерение, идентификация объектов)
- **main.js** - Точка входа в приложение, собирает все модули вместе

## Требования

- GeoServer 2.19+ с опубликованными слоями
- Современный веб-браузер с поддержкой JavaScript ES6
- Доступ к интернету для загрузки внешних библиотек

## Используемые технологии

- OpenLayers 7.3.0 - библиотека для работы с веб-картами
- Bootstrap 5.3.0 - CSS-фреймворк для стилизации интерфейса
- JavaScript ES6 модули - для модульной организации кода
- GeoServer - для публикации и раздачи пространственных данных

## Запуск

1. Убедитесь, что GeoServer запущен и доступен по адресу http://localhost:8080/geoserver
2. Откройте index.html в браузере или через локальный веб-сервер
3. При необходимости измените URL GeoServer в config.js

## Описание проекта

Данный проект представляет собой веб-геопортал, который визуализирует пространственные данные об объектах черной металлургии и промышленности Челябинской области. 
Геопортал включает в себя следующие функциональные возможности:
- Отображение интерактивной карты с различными слоями
- Возможность включения/отключения слоев
- Получение информации об объектах
- Измерение расстояний и площадей
- Выбор различных подложек (OpenStreetMap, спутниковые снимки, топографическая карта)

## Технологический стек

- **Frontend**: HTML, CSS, JavaScript, Bootstrap, OpenLayers
- **Backend**: GeoServer для публикации WMS/WFS сервисов
- **База данных**: PostgreSQL с расширением PostGIS
- **Подготовка геоданных**: QGIS

## Установка и настройка

### Предварительные требования

1. Установленный Docker для запуска GeoServer
2. PostgreSQL с PostGIS для хранения геоданных
3. QGIS для подготовки геоданных (опционально, если данные уже подготовлены)
4. Веб-сервер для хостинга фронтенд-части (можно использовать простой HTTP сервер)

### Настройка GeoServer

1. Запустите GeoServer с помощью Docker:
   ```bash
   docker run -d --name geoserver -p 8080:8080 kartoza/geoserver:latest
   ```

2. Откройте административную панель GeoServer по адресу `http://localhost:8080/geoserver/web/`
   (логин: admin, пароль: geoserver)

3. Создайте новый рабочий процесс (workspace) с именем `geoportal`

4. Настройте хранилище данных PostgreSQL:
   - Создайте новое хранилище данных типа PostGIS
   - Укажите параметры подключения к вашей PostgreSQL базе данных
   - Убедитесь, что в базе данных созданы соответствующие таблицы с геоданными

5. Опубликуйте слои из базы данных:
   - Опубликуйте каждый слой с соответствующим стилем
   - Настройте проекцию (рекомендуется EPSG:3857 для веб-карт)
   - Проверьте, что слои доступны через WMS

### Настройка веб-приложения

1. Отредактируйте файл `js/app.js`:
   - Укажите корректный URL вашего GeoServer в переменной `geoserverUrl`
   - Укажите название рабочего процесса в переменной `workspace`
   - При необходимости настройте центрирование карты на нужную территорию

2. Разместите файлы проекта на веб-сервере или запустите локальный сервер для разработки:
   ```bash
   # Если у вас установлен Node.js
   npx http-server -p 8000
   
   # Или с помощью Python
   python -m http.server 8000
   ```

3. Откройте браузер и перейдите по адресу `http://localhost:8000`

## Как использовать геопортал

1. **Управление слоями**: Используйте панель слоев в левой части для включения/отключения слоев
2. **Смена подложки**: Выберите нужную подложку из выпадающего списка
3. **Получение информации**: Нажмите кнопку "Информация" и кликните на объект для получения его атрибутов
4. **Измерение**: Нажмите кнопку "Измерить" и нарисуйте линию для измерения расстояния

## Особенности реализации

- Геопортал использует OpenLayers для отображения карты и взаимодействия с ней
- Данные о промышленных объектах загружаются через WMS сервисы GeoServer
- Интерфейс адаптивен и корректно работает на мобильных устройствах

## Дальнейшее развитие

- Добавление панели поиска объектов
- Интеграция аналитических инструментов
- Добавление возможности фильтрации объектов по атрибутам
- Реализация сохранения и загрузки пользовательских карт
- Добавление модуля создания отчетов

## Docker и контейнеризация

Проект полностью контейнеризирован и использует Docker для изоляции компонентов и управления данными.

### Компоненты

1. **Frontend (Nginx)** - статический веб-сервер для обслуживания пользовательского интерфейса
2. **GeoServer** - сервер для публикации геопространственных данных
3. **PostgreSQL/PostGIS** - СУБД для хранения геоданных

### Docker Volumes

Проект использует два Docker volumes для хранения данных:

- **geoserver_data** - хранит настройки, стили и опубликованные слои GeoServer
- **pg_data** - хранит данные PostgreSQL

Docker volumes не являются частью репозитория, они хранятся в системной директории Docker. Это обеспечивает сохранность данных между перезапусками контейнеров и позволяет легко переносить данные между серверами.

### Развертывание

Для развертывания проекта см. инструкции в файле [DEPLOYMENT.md](DEPLOYMENT.md).

#### Быстрый старт

```bash
# Клонирование репозитория
git clone https://github.com/yourusername/geoportal.git
cd geoportal

# Создание необходимых Docker volumes
docker volume create geoserver_data
docker volume create pg_data

# Запуск контейнеров
docker-compose up -d
```

#### Перенос данных на другой сервер

Для переноса данных с текущего сервера на новый используйте скрипты:

```bash
# На исходном сервере
./export_volumes.sh

# Скопируйте директорию backup на новый сервер, затем выполните
./import_volumes.sh
``` 